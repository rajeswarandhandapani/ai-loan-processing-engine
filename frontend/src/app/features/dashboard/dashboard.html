<!--
  TECHNICAL CONCEPT: Angular Template Syntax
  
  This is an Angular template that uses several key features:
  
  1. *ngIf - Structural directive for conditional rendering
     - Shows/hides elements based on boolean expression
     - Syntax: *ngIf="condition"
  
  2. {{ }} - Interpolation (Data Binding)
     - Displays component properties in the template
     - Automatically updates when property changes
     - Syntax: {{ propertyName }}
  
  3. | pipe - Angular Pipes for data transformation
     - currency: Formats numbers as currency
     - date: Formats dates
     - Syntax: {{ value | pipeName }}
  
  4. Bootstrap Grid System
     - container: Fixed-width responsive container
     - row: Horizontal group of columns
     - col-*: Column classes (col-md-6 = 50% width on medium+ screens)
     - Responsive breakpoints: xs, sm, md, lg, xl, xxl
-->

<div class="container-fluid py-4">
  
  <!-- LOADING STATE -->
  <!-- *ngIf shows this div only when isLoading is true -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Loading dashboard data...</p>
  </div>

  <!-- DASHBOARD CONTENT -->
  <!-- *ngIf shows this div only when NOT loading AND data exists -->
  <div *ngIf="!isLoading && dashboardData">
    
    <!-- HEADER SECTION -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h2 class="card-title mb-3">
              <i class="bi bi-graph-up-arrow text-primary me-2"></i>
              Financial Dashboard
            </h2>
            <div class="row">
              <div class="col-md-6">
                <p class="mb-1">
                  <strong>Business:</strong> 
                  <!-- Interpolation: Display businessName from component -->
                  {{ dashboardData.businessName }}
                </p>
                <p class="mb-1">
                  <strong>Applicant:</strong> 
                  {{ dashboardData.applicantName }}
                </p>
              </div>
              <div class="col-md-6 text-md-end">
                <p class="mb-1 text-muted">
                  <i class="bi bi-calendar-check me-1"></i>
                  <!-- Date Pipe: Formats date as 'Jan 1, 2024, 12:00 PM' -->
                  Data extracted: {{ dashboardData.extractedAt | date:'medium' }}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- KEY METRICS CARDS -->
    <!-- Bootstrap Grid: 4 columns on large screens, 2 on medium, 1 on small -->
    <div class="row g-3 mb-4">
      
      <!-- REVENUE CARD -->
      <div class="col-lg-3 col-md-6">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <p class="text-muted mb-1 small">Total Revenue</p>
                <h3 class="mb-0">
                  <!-- formatCurrency() method from component -->
                  {{ formatCurrency(dashboardData.financialSummary.revenue) }}
                </h3>
              </div>
              <div class="icon-box bg-success bg-opacity-10 p-3 rounded">
                <i class="bi bi-arrow-up-circle text-success fs-4"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- EXPENSES CARD -->
      <div class="col-lg-3 col-md-6">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <p class="text-muted mb-1 small">Total Expenses</p>
                <h3 class="mb-0">
                  {{ formatCurrency(dashboardData.financialSummary.expenses) }}
                </h3>
              </div>
              <div class="icon-box bg-danger bg-opacity-10 p-3 rounded">
                <i class="bi bi-arrow-down-circle text-danger fs-4"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- PROFIT CARD -->
      <div class="col-lg-3 col-md-6">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <p class="text-muted mb-1 small">Net Profit</p>
                <h3 class="mb-0 text-primary">
                  {{ formatCurrency(dashboardData.financialSummary.profit) }}
                </h3>
              </div>
              <div class="icon-box bg-primary bg-opacity-10 p-3 rounded">
                <i class="bi bi-piggy-bank text-primary fs-4"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- CASH FLOW CARD -->
      <div class="col-lg-3 col-md-6">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <p class="text-muted mb-1 small">Cash Flow</p>
                <h3 class="mb-0 text-info">
                  {{ formatCurrency(dashboardData.financialSummary.cashFlow) }}
                </h3>
              </div>
              <div class="icon-box bg-info bg-opacity-10 p-3 rounded">
                <i class="bi bi-cash-stack text-info fs-4"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- CHARTS SECTION -->
    <div class="row g-3">
      
      <!-- LINE CHART: Monthly Trends -->
      <!-- col-lg-8: Takes 8/12 columns (66.67%) on large screens -->
      <div class="col-lg-8">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <!--
              TECHNICAL CONCEPT: BaseChartDirective (ng2-charts)
              
              This is a directive from ng2-charts that renders Chart.js charts.
              
              Attributes:
              - type: Chart type (line, bar, pie, doughnut, etc.)
              - data: Chart data (labels + datasets)
              - options: Chart configuration (responsive, plugins, scales)
              
              How it works:
              1. Directive creates a <canvas> element
              2. Initializes Chart.js with provided config
              3. Watches for data changes
              4. Updates chart automatically when data changes
            -->
            <canvas 
              baseChart
              [type]="lineChartType"
              [data]="lineChartData"
              [options]="lineChartOptions">
            </canvas>
          </div>
        </div>
      </div>

      <!-- DOUGHNUT CHART: Revenue vs Expenses -->
      <!-- col-lg-4: Takes 4/12 columns (33.33%) on large screens -->
      <div class="col-lg-4">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <canvas 
              baseChart
              [type]="doughnutChartType"
              [data]="doughnutChartData"
              [options]="doughnutChartOptions">
            </canvas>
          </div>
        </div>
      </div>

      <!-- BAR CHART: Financial Summary -->
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <canvas 
              baseChart
              [type]="barChartType"
              [data]="barChartData"
              [options]="barChartOptions">
            </canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- INSIGHTS SECTION (Optional) -->
    <div class="row mt-4">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h5 class="card-title mb-3">
              <i class="bi bi-lightbulb text-warning me-2"></i>
              Key Insights
            </h5>
            <ul class="list-unstyled mb-0">
              <li class="mb-2">
                <i class="bi bi-check-circle text-success me-2"></i>
                Revenue shows consistent growth trend over the past 12 months
              </li>
              <li class="mb-2">
                <i class="bi bi-check-circle text-success me-2"></i>
                Profit margin: 
                <!-- Calculate profit margin percentage -->
                {{ ((dashboardData.financialSummary.profit / dashboardData.financialSummary.revenue) * 100).toFixed(1) }}%
              </li>
              <li class="mb-2">
                <i class="bi bi-info-circle text-info me-2"></i>
                Positive cash flow indicates healthy business operations
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- NO DATA STATE -->
  <!-- Shows when not loading but no data exists -->
  <div *ngIf="!isLoading && !dashboardData" class="text-center py-5">
    <i class="bi bi-inbox fs-1 text-muted"></i>
    <p class="mt-3 text-muted">No dashboard data available</p>
    <p class="text-muted small">Upload a financial document to see your dashboard</p>
  </div>

</div>
