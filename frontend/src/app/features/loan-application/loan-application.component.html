<div class="loan-application-container">
  <div class="page-header">
    <h2>Loan Application</h2>
    <p class="text-muted">Complete your loan application by uploading your documents and chatting with our AI assistant.</p>
  </div>

  <div class="application-steps">
    <div class="step-card">
      <div class="step-number">1</div>
      <div class="step-content">
        <h3>Upload Documents</h3>
        <p>Upload your financial documents including bank statements, tax returns, and business records.</p>
        <app-file-upload
          (uploadComplete)="onUploadComplete($event)"
          (allUploadsComplete)="onAllUploadsComplete($event)">
        </app-file-upload>
      </div>
    </div>

    <div class="step-card">
      <div class="step-number">2</div>
      <div class="step-content">
        <h3>Review Extracted Data</h3>
        <p>Our AI will extract and organize your financial information. Review and confirm the details.</p>
        <div class="data-preview">
          @if (uploadedDocuments.length === 0) {
            <div class="placeholder-box">
              <i class="bi bi-file-text"></i>
              <p>Extracted data will appear here</p>
            </div>
          } @else {
            <div class="extracted-data">
              @for (doc of uploadedDocuments; track doc.filename) {
                <div class="extracted-item">
                  <div class="extracted-header">
                    <i class="bi bi-file-earmark-check"></i>
                    <strong>{{ doc.filename }}</strong>
                  </div>
                  @if (doc.analysis) {
                    <div class="extracted-details">
                      @if (doc.analysis.page_count) {
                        <span class="badge bg-secondary">{{ doc.analysis.page_count }} pages</span>
                      }
                      @if (doc.analysis.key_value_pairs) {
                        <div class="key-values mt-2">
                          @for (item of doc.analysis.key_value_pairs | keyvalue; track item.key) {
                            <div class="kv-item">
                              <span class="kv-key">{{ item.key }}:</span>
                              <span class="kv-value">{{ item.value }}</span>
                            </div>
                          }
                        </div>
                      }
                    </div>
                  }
                </div>
              }
            </div>
          }
        </div>
      </div>
    </div>

    <div class="step-card">
      <div class="step-number">3</div>
      <div class="step-content">
        <h3>Chat with Assistant</h3>
        <p>Ask questions about your application, get clarification, and receive instant feedback.</p>
        <app-chat (messageSent)="onChatMessageSent($event)"></app-chat>
      </div>
    </div>
  </div>

  <div class="action-section">
    <button class="btn btn-outline-secondary me-2">Save Draft</button>
    <button class="btn btn-success">Submit Application</button>
  </div>
</div>
